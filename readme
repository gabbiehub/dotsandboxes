````markdown
# Dots & Boxes — Multiplayer

Networked Dots & Boxes with a C TCP server, a Node.js WebSocket proxy, and a modern React frontend.

This README documents the current architecture, new features (room list, grid-size selector, edge animation), dependencies, and exact commands to build and run the project locally.

## What's New (since last update)
- Room list support (`LIST_ROOMS` / `ROOM_LIST`) — lobby shows active rooms and player counts.
- Grid size selector in the lobby (3×3, 4×4, 5×5) — selection is sent to server on room creation (server currently uses fixed 4×4 grid).
- Edge color animation — clicked edges briefly show player color, then become permanent black.
- WebSocket proxy (`websocket-proxy.js`) to bridge browser WebSocket clients to the TCP server.

## Architecture Overview
- C TCP server (authoritative game state) — listens on TCP port **50000**
- Node.js WebSocket proxy — listens on **8080** and forwards websocket messages to TCP server
- React frontend (Vite + TypeScript) — development UI under `web-react/`, default dev port **3001**

## Requirements
- Linux (tested on Ubuntu / WSL)
- GCC (C11), `make`
- `libjson-c-dev` (JSON helpers)
- `libwebsockets-dev` (optional for client components)
- Node.js (v24+ recommended) and `npm` for the frontend

Install system deps on Debian/Ubuntu:

```bash
sudo apt update
sudo apt install -y build-essential libjson-c-dev libwebsockets-dev curl
# Install nvm (optional) and Node.js if you don't have it:
curl -o- https://raw.githubusercontent.com/nvm-sh/nvm/v0.39.5/install.sh | bash
export NVM_DIR="$HOME/.nvm"
[ -s "$NVM_DIR/nvm.sh" ] && \. "$NVM_DIR/nvm.sh"
nvm install 24
```

## Install & Build

1. Build the C server and CLI client:

```bash
make clean
make
```

2. Install frontend dependencies and build (or run dev server):

```bash
cd web-react
npm install
# Development server (live reload):
npm run dev
# Production build:
npm run build
```

## Running All Services (local dev)

Start the authoritative TCP server:

```bash
# from repo root
./server
```

Start the WebSocket proxy (bridges browser & TCP server):

```bash
node websocket-proxy.js
# listens on ws://localhost:8080 and forwards to TCP server:50000
```

Start the React dev server (open browser to URL shown):

```bash
cd web-react
npm run dev
# by default Vite picks port 3000, and will try 3001 if 3000 is busy
```

Open the UI at the Local URL printed by Vite (e.g. `http://localhost:3001/`) or on your phone using the network address (e.g. `http://192.168.1.5:3001/`).

## How to Play (Lobby → Game)

1. Load the frontend and log in with a username.
2. In the lobby you can:
   - Enter a `Room ID` and `Create Room` (sends `CREATE_ROOM` with `grid_size`).
   - Or click an available room card in the `Available Rooms` list to join it.
   - Choose grid size (3×3, 4×4, 5×5) before creating a room.
3. When a room reaches 2 players the server broadcasts `GAME_START` and game state updates via `GAME_STATE` messages.
4. Click edges on the canvas to place lines — edge animation will show player color briefly then the edge will be permanent.

## Protocol Notes

- Transport: newline-delimited JSON over TCP (proxied from browser via WebSocket proxy).
- New ops added:
  - `LIST_ROOMS` (client → server): request current room list
  - `ROOM_LIST` (server → client): reply with `rooms: [{ room_id, player_count, players, grid_size, status }]`
- `CREATE_ROOM` optionally includes `grid_size` (frontend sends value); the server currently ignores this and uses compile-time grid dimensions. See below for dynamic-grid notes.

Example messages:

Client → Server
```json
{"op":"LIST_ROOMS"}
{"op":"CREATE_ROOM","room_id":"room1","grid_size":4}
{"op":"JOIN_ROOM","room_id":"room1"}
{"op":"PLACE_LINE","x":0,"y":1,"orientation":"H"}
```

Server → Client
```json
{"op":"ROOM_LIST","rooms":[{"room_id":"room1","player_count":1,"grid_size":4,"status":"waiting","players":["alice"]}]}
{"op":"GAME_STATE","turn":0,"scores":[0,0],"board":{...}}
```

## Limitations & Next Steps

- Grid size: The React UI allows selecting 3×3, 4×4, 5×5 and sends `grid_size` during `CREATE_ROOM`, but the server currently uses fixed grid dimensions (`GRID_ROWS`/`GRID_COLS` in `include/common.h`). To fully support dynamic grid sizes you must:
  1. Refactor `GameState` to store grid dimensions
  2. Allocate `horizontal`, `vertical`, and `boxes` arrays dynamically
  3. Update `init_game_state()` and all game logic to use the dynamic sizes

- Room lifecycle: currently rooms persist in memory; you may want to implement timeouts or cleanup for empty rooms.

## Troubleshooting

- If ports are busy, kill leftover processes:

```bash
sudo lsof -ti:50000 | xargs -r kill -9
sudo lsof -ti:8080 | xargs -r kill -9
```

- If the browser cannot connect from a phone, use the network URL printed by Vite (e.g. `http://192.168.1.5:3001/`) and ensure your firewall allows connections.

## Development Notes

- Use `make` to build C binaries. Frontend uses `npm`/Vite.
- The project includes a `.gitignore` updated to exclude built assets, `node_modules`, and `.env` files.

## Commands Reference

```bash
# Build server and client
make

# Run server
./server

# Start WebSocket proxy
node websocket-proxy.js

# Frontend dev server (in separate terminal)
cd web-react
npm install
npm run dev

# Frontend production build
cd web-react
npm run build
```

## License & Attribution

Educational project for coursework. See `protocol.md` for full message API and examples.

````
3. **Server Handling**: Update `src/server/server.c`

4. **Web UI**: Edit `web/game.js` and `web/index.html`
